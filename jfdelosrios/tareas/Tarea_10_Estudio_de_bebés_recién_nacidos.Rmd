---
title: "Tarea 10"
author: "Jorge Fernando De Los Ríos"
date: "1/8/2019"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
    latex_engine: xelatex
---

\newpage

# Introducción

**Instala y carga el paquete MASS.**

Informacion del dataset en 
https://www.rdocumentation.org/packages/MASS/versions/7.3-51.4/topics/birthwt

```{r, eval=FALSE}
install.packages ("MASS")
```

```{r}
library(MASS)
```

**En el hay una tabla de datos llamada birthwt sobre factores que pueden incidir en el peso de los niños al nacer.**


Se usa la libreria `flextable` para graficar las tablas.

```{r}
library(flextable)
```


\newpage

# Punto 1

**Utiliza str() y head() para explorar la estructura, y con help(), mirar el significado de cada variable.**

Primero veo la ayuda para conocer la documentación del dataset.
    
```{r, eval=FALSE}
help(birthwt)
```

Con esta información creo un dataset con los features parseados.

```{r}
birthwt_1 <- birthwt

#indicator of birth weight less than 2.5 kg.
birthwt_1$low <- factor(
    birthwt$low, 
    labels = c("Menor que 2.5 kg", "Mayor que 2.5 kg")
  )

#mother's age in years.
birthwt_1$age <- birthwt$age

#mother's weight in pounds at last menstrual period.
birthwt_1$lwt <- birthwt$lwt

#mother's race
birthwt_1$race <- factor(
    birthwt$race,
    labels = c("Raza blanca", "Raza negra", "Otra raza")
  )

#smoking status during pregnancy.
birthwt_1$smoke <- factor(
    birthwt$smoke,
    labels = c("No", "Si")
  )

#number of previous premature labours.
birthwt_1$ptl <- birthwt$ptl

#history of hypertension.
birthwt_1$ht <- factor(
    birthwt$ht,
    labels = c("no hypertension", "hypertension.")
  )

#presence of uterine irritability.
birthwt_1$ui <- factor(
    birthwt$ui,
    labels = c("no-irritability", "irritability")
  )

#number of physician visits during the first trimester.
birthwt_1$ftv <- birthwt$ftv

#birth weight in grams.
birthwt_1$bwt <- birthwt$bwt
  
```


## Estructura del dataset

```{r}
str(birthwt_1)
```
  
## Primeros registros.  
```{r}
head(birthwt_1,n=6)
```

\newpage

# Punto 2

**Calcula una tabla de frecuencias relativas marginales de los pares (raza de la madre, peso inferior a 2.5 kg o no) que permita ver si la raza de la madre influye en el peso del bebé.**

```{r}
tabla_race_low <- table(
    birthwt_1$race,
    birthwt_1$low, 
    dnn=c("Raza de la madre", "Peso de nacimiento")
  )
```

Tabla de frecuencias relativas del peso de nacimiento, marginado por la raza de la madre.

```{r, eval=TRUE}

tabla_race_low_1 <- prop.table(tabla_race_low,margin = 1)

ft <- round(tabla_race_low_1, digits = 2)

ft <- as.data.frame.matrix(ft)

ft["Raza de la madre"] = rownames(ft)

ft <- ft[, c("Raza de la madre", "Menor que 2.5 kg", "Mayor que 2.5 kg")]

ft <- flextable(ft)
ft <- add_header_row(ft,
  colwidths = c(1, 2),
  values = c(" ", "Peso de nacimiento")
)

theme_box(ft)
```


Tabla de frecuencias relativas de la raza de la madre, marginado por el peso de nacimiento.

```{r}
tabla_race_low_2 <- prop.table(tabla_race_low,margin = 2)
  
knitr::kable(t(round(tabla_race_low_2, digits = 2)))
```

\newpage

# Punto 3

**Dibuja un diagrama de mosaico de la tabla del ejercicio anterior.**

```{r}
round(tabla_race_low_1, 2)
```
```{r}
mosaicplot(
    tabla_race_low_1,
    main = paste(
        "Gráfico de frecuencias relativas del peso de nacimiento,",
        "marginado por la raza de la madre.",
        sep = "\n"
      ),
    
    color = c("white", "black")
  )
```

\textcolor{red}{¿De qué depende el ancho de las barras?}

\newpage


```{r}
round(t(tabla_race_low_2), 1)
```

```{r}
mosaicplot(
    t(tabla_race_low_2),
    main = paste(
        "Gráfico de frecuencias relativas de la raza de la madre,",
        "marginado por el peso de nacimiento.",
        sep = "\n"
      ),
    
    color = c("white", "black", "orange")
  )
```


\newpage

# Punto 4

**Dibuja un diagrama bidimensional de barras, con las barras organizadas en bloques, que permita visualizar la información de los ejercicios anteriores. Aprovecha para nombres adecuados a los bloques, colores a las barras, y añadir una leyenda que explique qué representa cada barra.**



```{r}
round(t(tabla_race_low_1), 2)
```
```{r}
barplot(
    t(tabla_race_low_1),
    main = paste(
        "Gráfico de frecuencias relativas del peso de nacimiento,",
        "marginado por la raza de la madre.",
        sep = "\n"
      ),
    
    col = c("white", "black"),
    beside = TRUE,
    ylim = c(0,1),
    legend = TRUE
  )

abline(h = as.vector(tabla_race_low_1), lty = 2, col = "gray")
```




```{r}
round(t(tabla_race_low_1), 2)
```
```{r}
barplot(
    tabla_race_low_1,
    main = paste(
        "Gráfico de frecuencias relativas del peso de nacimiento,",
        "marginado por la raza de la madre.",
        sep = "\n"
      ),
    
    col = c("white", "green", "yellow"),
    beside = TRUE,
    ylim = c(0,1),
    legend = TRUE
  )

abline(h = as.vector(tabla_race_low_1), lty = 2, col = "gray")
```


\newpage


```{r}
round(tabla_race_low_2, 2)
```

```{r}
barplot(
    tabla_race_low_2,
    main = paste(
        "Gráfico de frecuencias relativas de la raza de la madre,",
        "marginado por el peso de nacimiento.",
        sep = "\n"
      ),
    
    col = c("white", "black", "orange"),
    beside = TRUE,
    ylim = c(0,1),
    legend = TRUE
  )

abline(h = as.vector(tabla_race_low_2), lty = 2, col = "gray")
```



```{r}
barplot(
    t(tabla_race_low_2),
    main = paste(
        "Gráfico de frecuencias relativas de la raza de la madre,",
        "marginado por el peso de nacimiento.",
        sep = "\n"
      ),
    
    col = c("white", "black"),
    beside = TRUE,
    ylim = c(0,1),
    legend = TRUE
  )

abline(h = as.vector(tabla_race_low_2), lty = 2, col = "gray")
```

\newpage
# Punto 5
**¿Se puede obtener alguna conclusión de la tabla y el diagrama de barras anterior? Argumenta tu respuesta**

* Es significativa la cantidad de recien nacidos de madres de raza blanca con peso mayor que 15 Kg.
* 

\newpage
# Punto 6

**Repite los cuatro ejercicios anteriores para los pares (madre fumadora o no, peso inferior a 2.5 kg o no) y para los pares (madre hipertensa o no, peso inferior a 2.5 kg o no.**

## Madre fumadora o no, peso inferior a 2.5 kg o no

### Punto 2

```{r, echo=TRUE}
tabla_smoke_low <- table(
    birthwt_1$smoke,
    birthwt_1$low, 
    dnn=c("habito fumador", "Peso de nacimiento")
  )
```

Tabla de frecuencias relativas del peso de nacimiento, marginado por si la madre fumaba en etapa de gestación.

```{r, eval=TRUE}

tabla_smoke_low_1 <- prop.table(tabla_smoke_low,margin = 1)

ft <- round(tabla_smoke_low_1, digits = 2)

ft <- as.data.frame.matrix(ft)

ft["fumaba en gestación gestación?"] = rownames(ft)

ft <- ft[, c("fumaba en gestación gestación?", "Menor que 2.5 kg", "Mayor que 2.5 kg")]

ft <- flextable(ft)
ft <- add_header_row(ft,
  colwidths = c(1, 2),
  values = c(" ", "Peso de nacimiento")
)

theme_box(ft)
```

Tabla de frecuencias relativas de si la madre fumaba en etapa de gestación, marginado por el peso de nacimiento.

```{r}
tabla_smoke_low_2 <- prop.table(tabla_smoke_low,margin = 2)
  
knitr::kable(t(round(tabla_smoke_low_2, digits = 2)))
```


### Punto 3

```{r}
tabla <- table(birthwt$smoke,birthwt$low)

mosaicplot(prop.table(tabla,margin = 1))
mosaicplot(prop.table(tabla,margin = 2))
```

\newpage

### Punto 4

```{r}
colores <- c("Red", "Green")
leyendaItems <- c("No Fuma", "Fuma")
tabla <- table(birthwt$smoke,birthwt$low)
xItems <- c("bebé Mayor a 25 Kg", "bebé menor a 25 Kg")

barplot(
  prop.table(tabla,margin = 1), 
  beside=TRUE,
  col=colores, 
  names=xItems,
  ylim=c(0,0.8)
  )
grid(nx=NA, ny=NULL,col = "gray48")
legend(x="topright", legend=leyendaItems, fill = colores, bg='white')
```

\newpage
```{r}

barplot(
  prop.table(tabla,margin = 2), 
  beside=TRUE,
  col=colores, 
  names=xItems,
  ylim=c(0,0.7)
)
grid(nx=NA, ny=NULL,col = "gray48")
legend(x="topright", legend=leyendaItems, fill = colores, bg='white')
```


### Punto 5

* Conclucion1

\newpage
## Madre hipertensa o no, peso inferior a 2.5 kg o no

### Punto 2

```{r}
tabla <- table(birthwt$ht,birthwt$low)

prop.table(tabla,margin = 1)
prop.table(tabla,margin = 2)
```

### Punto 3

```{r}
tabla <- table(birthwt$ht,birthwt$low)

mosaicplot(prop.table(tabla,margin = 1))
```

\newpage
```{r}
mosaicplot(prop.table(tabla,margin = 2))
```


\newpage
### Punto 4

```{r}
colores <- c("Pink", "Blue")
leyendaItems <- c("Madre no hipertensa", "Madre hipertensa")
tabla <- table(birthwt$ht,birthwt$low)
xItems <- c("bebé Mayor a 25 Kg", "bebé menor a 25 Kg")

barplot(
  prop.table(tabla,margin = 1),
  beside = TRUE,
  col = colores, 
  names = xItems,
  ylim = c(0,0.8)
)
grid(nx=NA, ny=NULL,col = "gray48")
legend(x="topright", legend = leyendaItems, fill = colores, bg='white')

```

\newpage
```{r}
barplot(
  prop.table(tabla,margin = 2),
  beside=TRUE,
  col=colores, 
  names=xItems,
  ylim=c(0,1.3)
)
grid(nx=NA, ny=NULL,col = "gray48")
legend(x = "topright", legend = leyendaItems, fill = colores, bg='white')
```


### Punto 5

* Conclucion1


\newpage
# Punto 7

**Calcula una tabla de frecuencias relativas marginales de las ternas (raza de la madre, madre fumadora o no, peso inferior a 2.5 kg o no) que permita ver si la raza de la madre y su condición de fumadora o no fumadora influyen en el peso del bebé.**

```{r}
tabla <- table(birthwt$race,birthwt$smoke,birthwt$low)
prop.table(tabla,margin = 1)
prop.table(tabla,margin = 2)
```

\newpage
```{r}
prop.table(tabla,margin = 3)
``` 


\newpage
# Punto 8
**Dibuja un diagrama de mosaico de la tabla del ejercicio anterior.**

```{r}
tabla <- table(birthwt$race,birthwt$smoke,birthwt$low)

mosaicplot(prop.table(tabla,margin = 1))
```

\newpage
```{r}
mosaicplot(prop.table(tabla,margin = 2))
```

\newpage
```{r}
mosaicplot(prop.table(tabla,margin = 3))
```